# PDF下载功能说明

## 功能概述

翻译完成后，可以将译文导出为以下格式：
- 📋 **复制到剪贴板**：快速复制所有译文
- 📄 **TXT文本文件**：纯文本格式，兼容性好
- 📕 **PDF文档**：专业格式，保留排版

---

## PDF下载功能

### 特点

✅ **支持中文**：自动使用系统中文字体
✅ **自动分页**：内容过长自动创建新页
✅ **保留结构**：按原PDF页码组织
✅ **专业排版**：A4纸张，合适的边距和行距

### 使用方法

1. 完成PDF翻译
2. 点击底部的 **"📕 下载PDF"** 按钮
3. 等待PDF生成（通常几秒钟）
4. 浏览器自动下载 `翻译结果.pdf`

### PDF格式说明

#### 页面设置
- **纸张大小**：A4 (210mm × 297mm)
- **页边距**：0.75英寸 (约19mm)
- **字体大小**：12pt (正文)，14pt (标题)

#### 内容组织
```
第 1 页
─────────────────────
[译文内容]
[自动换行]
[段落分隔]

[新页]

第 2 页
─────────────────────
[译文内容]
...
```

#### 字体支持

**macOS系统**：
- 优先使用：STHeiti Light (华文黑体)
- 备选：PingFang (苹方)
- 降级：Helvetica (不支持中文)

**Windows系统**：
- 需要手动配置中文字体路径
- 或使用默认字体（可能显示方框）

---

## 与TXT格式对比

| 特性 | PDF | TXT |
|------|-----|-----|
| 文件大小 | 较大 | 较小 |
| 格式保留 | ✅ 保留 | ❌ 纯文本 |
| 打印效果 | ✅ 专业 | ⚠️ 简单 |
| 编辑方便 | ❌ 不易编辑 | ✅ 易编辑 |
| 兼容性 | ✅ 通用 | ✅ 通用 |
| 中文支持 | ✅ 完美 | ✅ 完美 |

### 选择建议

**选择PDF，如果你需要**：
- 打印译文
- 专业文档
- 保留格式
- 分享给他人

**选择TXT，如果你需要**：
- 继续编辑
- 复制粘贴
- 文件小巧
- 快速查看

---

## 常见问题

### Q: PDF中文显示为方框？
**原因**：系统缺少中文字体或字体路径不正确

**解决方案**：
1. **macOS用户**：通常自动支持，无需操作
2. **Windows用户**：需要配置字体路径
3. **Linux用户**：安装中文字体包

**临时方案**：使用TXT格式下载

### Q: PDF生成很慢？
**原因**：内容较多，需要处理时间

**正常情况**：
- 10页以内：1-3秒
- 10-50页：3-10秒
- 50页以上：10-30秒

**优化建议**：
- 耐心等待
- 不要重复点击
- 查看浏览器下载进度

### Q: PDF排版不理想？
**原因**：自动换行算法的限制

**改进方法**：
1. 下载TXT格式
2. 使用专业PDF编辑器调整
3. 或使用Word等工具重新排版

### Q: 可以自定义PDF样式吗？
**当前版本**：使用固定样式

**未来计划**：
- 可选字体大小
- 可选页边距
- 可选纸张大小
- 添加页眉页脚

### Q: PDF文件太大？
**原因**：内容多或字体嵌入

**解决方案**：
1. 使用PDF压缩工具
2. 或下载TXT格式（更小）

---

## 技术细节

### 使用的库
- **ReportLab**：Python PDF生成库
- 版本：4.0.7
- 文档：https://www.reportlab.com/

### 字体处理
```python
# macOS系统字体路径
/System/Library/Fonts/STHeiti Light.ttc
/System/Library/Fonts/PingFang.ttc

# Windows系统字体路径（需配置）
C:\Windows\Fonts\simhei.ttf
C:\Windows\Fonts\simsun.ttc
```

### 自动换行算法
- 估算每行字符数：约 `text_width / 7`
- 使用 `textwrap.wrap()` 自动分行
- 段落间添加额外间距

### 分页逻辑
- 检查剩余空间
- 不足时自动创建新页
- 每个原PDF页面后强制分页

---

## 高级用法

### 批量下载
1. 翻译多个PDF
2. 分别下载为PDF
3. 使用PDF合并工具合并

### 自定义文件名
当前：固定为 `翻译结果.pdf`

**未来支持**：
- 使用原PDF文件名
- 添加日期时间
- 自定义命名规则

### 与原PDF对比
**建议工作流**：
1. 下载译文PDF
2. 使用PDF阅读器并排查看
3. 对照原PDF和译文PDF

---

## 故障排查

### 问题：点击下载无反应
**检查**：
1. 浏览器控制台是否有错误
2. 是否有翻译内容
3. 网络连接是否正常

**解决**：
1. 刷新页面重试
2. 查看PyCharm运行窗口错误
3. 尝试下载TXT格式

### 问题：下载的PDF打不开
**原因**：PDF生成失败或损坏

**解决**：
1. 重新生成PDF
2. 检查服务器日志
3. 尝试其他PDF阅读器

### 问题：PDF内容不完整
**原因**：生成过程中断

**解决**：
1. 确保翻译完全完成
2. 重新下载
3. 检查是否有错误提示

---

## 性能优化

### 生成速度
- 小文件（<10页）：即时生成
- 中等文件（10-50页）：几秒钟
- 大文件（>50页）：可能需要等待

### 文件大小
- 纯文本PDF：较小
- 嵌入字体PDF：较大
- 压缩后：可减小30-50%

---

## 未来改进

计划中的功能：
- [ ] 自定义字体和大小
- [ ] 可选页面布局
- [ ] 添加页眉页脚
- [ ] 支持双语对照PDF
- [ ] 自定义文件名
- [ ] PDF元数据设置
- [ ] 水印功能
- [ ] 目录生成

---

## 总结

### 推荐使用场景

**PDF格式**：
- ✅ 需要打印
- ✅ 正式文档
- ✅ 长期保存
- ✅ 分享传阅

**TXT格式**：
- ✅ 继续编辑
- ✅ 快速查看
- ✅ 文件传输
- ✅ 文本处理

### 最佳实践

1. **翻译完成后**：先预览译文质量
2. **确认无误**：再下载PDF
3. **保存备份**：同时下载TXT和PDF
4. **专业用途**：使用PDF格式
5. **编辑需求**：使用TXT格式

祝你使用愉快！📕

