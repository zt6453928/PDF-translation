# 故障排查指南

## 阿里云API 500错误

如果使用阿里云API时出现500错误，请按以下步骤排查：

### 1. 检查API Key格式

✅ **正确格式**：
```
sk-xxxxxxxxxxxxxxxxxxxxxxxx
```

❌ **错误格式**：
- 缺少 `sk-` 前缀
- 包含空格
- 复制不完整

### 2. 验证API Key是否有效

运行测试脚本：
```bash
python test_aliyun_api.py YOUR_API_KEY
```

如果测试成功，说明API Key有效。

### 3. 检查阿里云账户状态

登录阿里云控制台检查：
- ✅ DashScope服务已开通
- ✅ API Key状态为"启用"
- ✅ 账户余额充足
- ✅ 没有欠费

### 4. 检查模型名称

确保使用正确的模型名称：
- `qwen-max` ✅
- `qwen-plus` ✅
- `qwen-turbo` ✅

**注意**：不是 `qwen3-max` 或其他变体

### 5. 查看详细错误信息

在PyCharm的运行窗口中查看完整的错误堆栈：

```
[阿里云翻译] 使用模型: qwen-max, API Key: sk-xxxxxx...
[阿里云翻译] 翻译方向: auto -> Chinese
[阿里云翻译] 文本长度: 123 字符
[错误] 阿里云翻译出错: xxxxx
```

### 6. 常见错误及解决方案

#### 错误：`Invalid API Key`
**原因**：API Key无效或格式错误
**解决**：
1. 重新复制API Key
2. 确保包含完整的 `sk-` 前缀
3. 检查是否有多余的空格

#### 错误：`Model not found`
**原因**：模型名称错误
**解决**：
1. 使用 `qwen-max`、`qwen-plus` 或 `qwen-turbo`
2. 检查拼写是否正确

#### 错误：`Insufficient balance`
**原因**：账户余额不足
**解决**：
1. 登录阿里云控制台充值
2. 检查是否有免费额度

#### 错误：`Rate limit exceeded`
**原因**：请求频率过高
**解决**：
1. 等待几分钟后重试
2. 减少并发翻译数量

#### 错误：`Connection timeout`
**原因**：网络连接问题
**解决**：
1. 检查网络连接
2. 尝试使用VPN（如果在国外）
3. 检查防火墙设置

### 7. 网络问题排查

测试网络连接：
```bash
curl https://dashscope.aliyuncs.com/compatible-mode/v1/models
```

如果无法连接，可能是：
- 防火墙阻止
- DNS解析问题
- 网络不稳定

### 8. 启用详细日志

在 `app.py` 中已经添加了详细日志，运行时会显示：
- 使用的模型
- API Key前缀
- 翻译方向
- 文本长度
- 详细错误堆栈

### 9. 对比测试

如果阿里云API不工作，可以：
1. 先测试DeepLX API（如果有）
2. 确认是API问题还是应用问题
3. 使用测试脚本单独测试阿里云API

### 10. 获取帮助

如果以上方法都无法解决，请提供以下信息：

1. **错误信息**：完整的错误堆栈
2. **API Key状态**：是否有效（不要泄露完整Key）
3. **测试结果**：`test_aliyun_api.py` 的输出
4. **网络环境**：是否使用代理/VPN
5. **账户状态**：余额、服务开通情况

---

## DeepLX API问题

### 错误：`请先配置API地址`
**解决**：在配置面板填入完整的DeepLX API地址

### 错误：`翻译API返回错误: 404`
**原因**：API地址不正确
**解决**：检查API地址格式，确保包含完整路径

### 错误：`翻译请求超时`
**原因**：网络慢或API服务响应慢
**解决**：
1. 检查网络连接
2. 稍后重试
3. 更换API服务

---

## PDF上传问题

### 错误：`PDF中没有提取到文本内容`
**原因**：PDF是扫描版或图片PDF
**解决**：
1. 使用OCR工具先转换PDF
2. 使用包含文本层的PDF

### 错误：`文件过大`
**原因**：PDF超过16MB限制
**解决**：
1. 压缩PDF
2. 分割PDF为多个小文件

---

## 浏览器问题

### 配置丢失
**原因**：清除了浏览器数据
**解决**：重新配置API

### 页面显示异常
**解决**：
1. 清除浏览器缓存
2. 强制刷新（Ctrl+F5）
3. 尝试其他浏览器

---

## 性能优化建议

1. **大文件翻译**：
   - 使用 `qwen-turbo` 模型
   - 分批翻译

2. **高质量翻译**：
   - 使用 `qwen-max` 模型
   - 单页翻译

3. **成本控制**：
   - 监控API使用量
   - 设置费用预警
   - 选择合适的模型

---

## 联系支持

- **阿里云技术支持**：https://help.aliyun.com/
- **DashScope文档**：https://help.aliyun.com/zh/dashscope/
- **工单系统**：阿里云控制台 -> 工单

