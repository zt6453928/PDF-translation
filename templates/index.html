<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFç¿»è¯‘å™¨</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å·¥å…·æ  -->
        <div class="top-toolbar">
            <h1>ğŸ“„ PDFç¿»è¯‘å™¨</h1>
            <div class="toolbar-actions">
                <input type="file" id="pdfFile" accept=".pdf,application/pdf" class="visually-hidden-file">
                <label id="uploadBtn" for="pdfFile" class="toolbar-btn" title="é€‰æ‹©PDF" role="button" tabindex="0">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <span>é€‰æ‹©PDF</span>
                </label>
                <button id="translateBtn" class="toolbar-btn toolbar-btn-primary" disabled title="å¼€å§‹ç¿»è¯‘">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path>
                    </svg>
                    <span>å¼€å§‹ç¿»è¯‘</span>
                </button>
                <button id="menuBtn" class="icon-btn" title="è®¾ç½®">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                        <!-- Feather icons: settings -->
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82a2 2 0 1 1-2.83 2.83a1.65 1.65 0 0 0-1.82.33a2 2 0 1 1-3.4 0a1.65 1.65 0 0 0-1.82-.33a2 2 0 1 1-2.83-2.83a1.65 1.65 0 0 0 .33-1.82a2 2 0 1 1 0-3.4a1.65 1.65 0 0 0-.33-1.82a2 2 0 1 1 2.83-2.83a1.65 1.65 0 0 0 1.82-.33a2 2 0 1 1 3.4 0a1.65 1.65 0 0 0 1.82.33a2 2 0 1 1 2.83 2.83a1.65 1.65 0 0 0-.33 1.82a2 2 0 1 1 0 3.4z"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- ä¾§è¾¹èœå• -->
        <div class="side-menu" id="sideMenu">
            <div class="menu-header">
                <h3>è®¾ç½®</h3>
                <button id="closeMenuBtn" class="close-btn">âœ•</button>
            </div>

            <div class="menu-content">
                <!-- APIé…ç½® -->
                <div class="menu-section">
                    <h4>ç¿»è¯‘æœåŠ¡</h4>
                    <select id="apiType" class="menu-select">
                        <option value="deeplx">DeepLX</option>
                        <option value="aliyun">é˜¿é‡Œäº‘ (é€šä¹‰åƒé—®)</option>
                    </select>
                </div>

                <div class="menu-section" id="deeplxConfig">
                    <h4>DeepLX API</h4>
                    <input type="text" id="deeplxUrl" class="menu-input"
                           placeholder="https://api.deeplx.org/YOUR_KEY/translate" />
                </div>

                <div class="menu-section" id="aliyunConfig" style="display: none;">
                    <h4>é˜¿é‡Œäº‘é…ç½®</h4>
                    <input type="text" id="aliyunKey" class="menu-input"
                           placeholder="API Key: sk-xxxxxxxx" />
                    <input type="text" id="aliyunModel" class="menu-input"
                           placeholder="æ¨¡å‹: qwen-plus"
                           title="å¸¸ç”¨: qwen-max, qwen-plus, qwen-turbo" />
                </div>

                <button id="saveApiBtn" class="menu-btn">ä¿å­˜é…ç½®</button>

                <!-- è¯­è¨€è®¾ç½® -->
                <div class="menu-section">
                    <h4>æºè¯­è¨€</h4>
                    <select id="sourceLang" class="menu-select">
                        <option value="auto">è‡ªåŠ¨æ£€æµ‹</option>
                        <option value="EN">è‹±è¯­</option>
                        <option value="ZH">ä¸­æ–‡</option>
                        <option value="JA">æ—¥è¯­</option>
                        <option value="KO">éŸ©è¯­</option>
                        <option value="FR">æ³•è¯­</option>
                        <option value="DE">å¾·è¯­</option>
                        <option value="ES">è¥¿ç­ç‰™è¯­</option>
                        <option value="RU">ä¿„è¯­</option>
                    </select>
                </div>

                <div class="menu-section">
                    <h4>ç›®æ ‡è¯­è¨€</h4>
                    <select id="targetLang" class="menu-select">
                        <option value="ZH">ä¸­æ–‡</option>
                        <option value="EN">è‹±è¯­</option>
                        <option value="JA">æ—¥è¯­</option>
                        <option value="KO">éŸ©è¯­</option>
                        <option value="FR">æ³•è¯­</option>
                        <option value="DE">å¾·è¯­</option>
                        <option value="ES">è¥¿ç­ç‰™è¯­</option>
                        <option value="RU">ä¿„è¯­</option>
                    </select>
                </div>

                <!-- å¯¼å‡ºé€‰é¡¹ -->
                <div class="menu-section" id="exportSection" style="display: none;">
                    <h4>å¯¼å‡ºè¯‘æ–‡</h4>
                    <button id="menuCopyBtn" class="menu-btn-small">ğŸ“‹ å¤åˆ¶</button>
                    <button id="menuDownloadTxtBtn" class="menu-btn-small">ğŸ“„ TXT</button>
                    <button id="menuDownloadPdfBtn" class="menu-btn-small">ğŸ“• PDF</button>
                </div>
            </div>
        </div>



        <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill"></div>
            <span class="progress-text" id="progressText">0%</span>
        </div>

        <!-- ç§»åŠ¨ç«¯æ ‡ç­¾åˆ‡æ¢ï¼ˆ<=414pxå¯è§ï¼‰ -->
        <div class="mobile-tabs" id="mobileTabs" role="tablist" aria-label="è§†å›¾åˆ‡æ¢" style="display:none;">
            <button class="mobile-tab active" id="tabOriginal" data-target="original" role="tab" aria-selected="true">åŸæ–‡</button>
            <button class="mobile-tab" id="tabTranslated" data-target="translated" role="tab" aria-selected="false">è¯‘æ–‡</button>
        </div>

        <!-- è§†å›¾æ¯”ä¾‹æ»‘åŠ¨æ¡ï¼ˆåœ¨éæ ‡ç­¾æ¨¡å¼ä¸‹ç”¨äºè°ƒæ•´åŸæ–‡/è¯‘æ–‡å æ¯”ï¼‰ -->
        <div class="split-controls" id="splitControls" aria-label="è°ƒæ•´åŸæ–‡ä¸è¯‘æ–‡æ˜¾ç¤ºæ¯”ä¾‹" style="display:none;">
            <span class="split-label">è§†å›¾æ¯”ä¾‹</span>
            <input type="range" id="splitRange" min="20" max="80" step="1" value="50" aria-valuemin="20" aria-valuemax="80" aria-valuenow="50" aria-label="åŸæ–‡æ¯”ä¾‹(%)" />
            <span class="split-value" id="splitValue">50%</span>
        </div>

        <div class="content-wrapper">
            <div class="panel" id="panelOriginal" data-pane="original">
                <div class="panel-header">
                    <h2>PDFåŸæ–‡</h2>
                    <div class="page-navigation" id="pdfNavigation" style="display: none;">
                        <button class="nav-btn" id="pdfPrevBtn">â—€</button>
                        <span class="page-indicator">
                            <input type="number" id="pdfPageInput" min="1" value="1" />
                            <span>/</span>
                            <span id="pdfTotalPages">0</span>
                        </span>
                        <button class="nav-btn" id="pdfNextBtn">â–¶</button>
                    </div>
                    <div class="zoom-controls" id="zoomControls" style="display: none;">
                        <div class="zoom-group" id="pageZoomGroup" title="é¡µé¢æ•´ä½“ç¼©æ”¾ï¼ˆæ–‡å­—ã€å¸ƒå±€ã€å›¾ç‰‡ï¼‰">
                            <label for="pageZoomRange">é¡µé¢ç¼©æ”¾</label>
                            <input type="range" id="pageZoomRange" min="50" max="200" step="10" value="100" />
                            <span id="pageZoomLabel">100%</span>
                        </div>
                        <div class="zoom-group" id="imageZoomGroup" title="ä»…æ”¾å¤§é¡µé¢ä¸­çš„å›¾ç‰‡ï¼Œä¸å½±å“æ–‡å­—ä¸å¸ƒå±€">
                            <label for="imageZoomRange">å›¾ç‰‡ç¼©æ”¾</label>
                            <input type="range" id="imageZoomRange" min="100" max="300" step="10" value="100" />
                            <span id="imageZoomLabel">100%</span>
                        </div>
                    </div>
                    <span class="page-info" id="originalPageInfo"></span>
                </div>
                <div class="panel-content pdf-viewer" id="originalContent">
                    <div class="placeholder">
                        <p>è¯·ä¸Šä¼ PDFæ–‡ä»¶</p>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="panel" id="panelTranslated" data-pane="translated">
                <div class="panel-header">
                    <h2>è¯‘æ–‡</h2>
                    <div class="page-navigation" id="translationNavigation" style="display: none;">
                        <button class="nav-btn" id="transPrevBtn">â—€</button>
                        <span class="page-indicator">
                            <input type="number" id="transPageInput" min="1" value="1" />
                            <span>/</span>
                            <span id="transTotalPages">0</span>
                        </span>
                        <button class="nav-btn" id="transNextBtn">â–¶</button>
                    </div>
                    <span class="page-info" id="translatedPageInfo"></span>
                </div>
                <div class="panel-content" id="translatedContent">
                    <div class="placeholder">
                        <p>ç¿»è¯‘ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <div class="toast" id="toast"></div>

    <!-- PDF.jsï¼ˆä½¿ç”¨CDNï¼›å¦‚éœ€ç¦»çº¿ï¼Œè¯·å°†æ–‡ä»¶æ”¾åˆ° static/vendor/pdfjs å¹¶è°ƒæ•´è·¯å¾„ï¼‰ -->
    <script>
        // åŠ¨æ€åŠ è½½PDF.jsï¼ˆä¼˜å…ˆæœ¬åœ°vendorï¼Œå…¶æ¬¡CDNï¼‰
        (function loadPdfJs() {
            function addScript(src, onload) {
                var s = document.createElement('script');
                s.src = src;
                s.onload = onload;
                s.onerror = function() { console.warn('åŠ è½½å¤±è´¥:', src); };
                document.body.appendChild(s);
            }
            // ç‰ˆæœ¬é€‰ç”¨ç¨³å®š UMD æ„å»ºï¼ˆ2.16.105ï¼‰ï¼›å¦‚éœ€å‡çº§ï¼Œå¯åŒæ­¥ä¿®æ”¹ workerSrc
            var localBase = '{{ url_for('static', filename='vendor/pdfjs') }}';
            var cdnBase = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105';
            var loaded = false;
            function onLoaded() { loaded = true; }

            // å°è¯•æœ¬åœ°
            addScript(localBase + '/pdf.min.js', function() {
                onLoaded();
            });
            // å…œåº•CDN
            setTimeout(function() {
                if (!loaded) {
                    addScript(cdnBase + '/pdf.min.js', onLoaded);
                }
            }, 300);

            // é¢å¤–å°è¯•åŠ è½½SVGæ¸²æŸ“æ”¯æŒï¼ˆéƒ¨åˆ†æ„å»ºå·²å†…ç½®SVGGraphicsï¼Œè¿™é‡Œå°½é‡è¡¥é½ï¼‰
            setTimeout(function() {
                if (window.pdfjsLib && pdfjsLib.SVGGraphics) return;
                // æœ¬åœ°svg
                addScript(localBase + '/svg.min.js', function(){});
                // CDN svg
                setTimeout(function(){
                    if (!(window.pdfjsLib && pdfjsLib.SVGGraphics)) {
                        addScript(cdnBase + '/svg.min.js', function(){});
                    }
                }, 200);
            }, 800);
        })();
    </script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
